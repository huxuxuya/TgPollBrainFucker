# TgPollBrainFucker: Advanced Telegram Poll Bot

Мощный и функциональный Telegram-бот для создания настраиваемых опросов и управления фандрайзинговыми кампаниями в группах. Все управление осуществляется через приватный чат с ботом, что обеспечивает чистоту групповых чатов.

## Основные цели проекта
- Удобное и чистое управление опросами через приватный дашборд
- Гибкая настройка опций опросов (отображение голосов, стили, счетчики, приоритеты, эмодзи)
- Интеграция сбора средств с автоматическим подсчетом и прогресс-баром
- Мощные админ-инструменты (напоминания, репосты, ручное редактирование голосов, управление участниками)
- Поддержка резервного копирования и восстановления данных

## Архитектура и структура проекта

- **Ядро бота**: асинхронный python-telegram-bot, обработчики событий и команд вынесены в отдельные модули (src/handlers/).
- **Работа с БД**: SQLAlchemy (ORM) для кросс-платформенной работы с SQLite и PostgreSQL. Все операции с БД реализованы через ORM. Alembic используется для миграций схемы.
- **Web Apps**: три отдельных web-приложения (simple_vote, timeline_vote, advanced_vote) реализованы на Starlette/Uvicorn/Jinja2, интегрируются с ботом через Telegram Web App API.
- **Визуализация**: модули display.py и drawing.py отвечают за генерацию изображений и визуальных элементов опросов.
- **Конфигурация**: config.py, поддержка .env для хранения токенов и параметров окружения.
- **Тестирование**: покрытие ключевых компонентов через pytest (tests/).
- **Миграции**: alembic/versions/ содержит все необходимые миграции для поддержки актуальной схемы БД.
- **Вспомогательные скрипты**: для миграции данных, отображения результатов, работы с участниками.

## Основные директории и файлы

- **src/bot.py** — запуск и основная логика бота
- **src/database.py** — модели и методы доступа к БД через ORM
- **src/handlers/** — обработчики команд, событий, админки, настроек, голосования и пр.
- **src/web_apps/** — web-приложения для расширенного голосования
- **src/display.py, drawing.py** — визуализация и генерация изображений
- **src/config.py** — конфигурация проекта
- **api/index.py** — внешний API (если требуется)
- **alembic/** — миграции Alembic
- **tests/** — тесты

## Интеграция и расширяемость

- Проект поддерживает расширение через добавление новых web apps и обработчиков.
- Вся работа с БД строго через ORM, что обеспечивает переносимость между SQLite и PostgreSQL.
- Миграции позволяют безопасно обновлять схему данных без потери информации.

## Технологии

- python-telegram-bot (async)
- SQLAlchemy, Alembic
- Starlette, Uvicorn, Jinja2
- SQLite, PostgreSQL
- Pillow (визуализация)
- pytest (тестирование)

---

_Документ актуализирован по результатам VAN-ревизии кода и структуры проекта._
