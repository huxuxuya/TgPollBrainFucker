# Telegram Poll & Money Collection Bot

Бот для проведения опросов и сбора информации/денег в Telegram-группах с современным интерфейсом и поддержкой супергрупп.

## Возможности

- **Автоматический сбор участников** (с учётом исключённых)
- **Создание и настройка опросов** (текст, варианты)
- **Голосование через кнопки**
- **Просмотр результатов с уникальными голосами**
- **Список не проголосовавших** (без дублей)
- **Обновление результатов в группе одной кнопкой**
- **Список участников по всем группам**
- **Корректная работа с миграцией групп в супергруппы**
- **Управление через меню и кнопки**
- **Гибкий debug-режим**

## Развертывание на Render.com

1. **Создайте репозиторий**: Убедитесь, что ваш код находится в Git-репозитории (например, на GitHub).
2. **Настройка на Render.com**:
   - Зарегистрируйтесь на [render.com](https://render.com) и создайте новый 'Bot' или 'Web Service'.
   - Подключите ваш репозиторий.
   - В настройках укажите:
     - **Runtime**: Python 3.
     - **Build Command**: `pip install -r requirements.txt`.
     - **Start Command**: `python bot.py`.
   - Добавьте переменную окружения `BOT_TOKEN` в разделе 'Environment'. Значение возьмите из вашего `.env` файла.
3. **Хранение базы данных**: Поскольку Render.com использует эфемерное хранилище, рассмотрите использование внешней базы данных (например, PostgreSQL) или облачного хранилища для файла `poll_data.db`.

## Локальный запуск

1. Установите зависимости: `pip install -r requirements.txt`.
2. Убедитесь, что у вас есть файл `.env` с переменной `BOT_TOKEN`.
3. Запустите бота: `python bot.py`.

## Основные команды

- `/start` — Главное меню
- `/help` — Справка
- `/collect` — Собрать участников группы
- `/exclude` — Исключить участника из опроса
- `/newpoll` — Создать новый опрос (через выбор группы)
- `/setmessage <текст>` — Установить текст опроса
- `/setoptions <варианты через запятую>` — Установить варианты ответа
- `/startpoll` — Запустить опрос
- `/results` — Показать результаты опроса
- `/mychats` — Показать список известных групп
- `/cleangroup` — Очистить список участников группы

## Кнопочное меню

- **Создание опроса** — через выбор группы
- **Список участников** — по всем группам сразу
- **Список групп** — выбор группы кнопкой
- **Обновить результаты в группе** — отдельная кнопка в результатах

## Особенности

- Все действия с группами происходят через выбор кнопкой (даже если группа одна)
- При миграции группы в супергруппу бот автоматически обновляет chat_id во всех таблицах
- В результатах опроса и списке не проголосовавших учитываются только уникальные пользователи
- Для админов доступно удобное меню управления
- Все сообщения форматируются для лучшей читаемости (HTML)

## Зависимости

- python-telegram-bot==20.8
- python-dotenv

## Переменные окружения

- `BOT_TOKEN` — токен Telegram-бота (обязателен)

## FAQ

- **Бот не видит группу?**
  — Добавьте бота в группу и дайте права администратора, напишите любое сообщение в группе.
- **Группа мигрировала в супергруппу?**
  — Бот автоматически обновит chat_id и продолжит работу.
- **Не отображаются участники/результаты?**
  — Используйте /collect и убедитесь, что бот админ.

---

**Разработка и поддержка:** t.me/yourusername 