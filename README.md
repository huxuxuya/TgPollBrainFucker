# Telegram Poll & Money Collection Bot

Бот для проведения опросов и сбора информации/денег в Telegram-группах с современным интерфейсом и поддержкой супергрупп.

## Возможности

- **Автоматический сбор участников** (с учётом исключённых)
- **Создание и настройка опросов** (текст, варианты)
- **Голосование через кнопки**
- **Просмотр результатов с уникальными голосами**
- **Список не проголосовавших** (без дублей)
- **Обновление результатов в группе одной кнопкой**
- **Список участников по всем группам**
- **Корректная работа с миграцией групп в супергруппы**
- **Управление через меню и кнопки**
- **Гибкий debug-режим**

## Установка

1. Установите Python 3.8 или выше.
2. Установите зависимости:
   ```
   pip install -r requirements.txt
   ```
3. Создайте бота через [@BotFather](https://t.me/BotFather) и получите токен.
4. Создайте файл `.env` в корне проекта и добавьте строку:
   ```
   BOT_TOKEN=ваш_токен_бота
   ```
5. Запустите бота:
   ```
   python bot.py
   ```
6. Добавьте бота в нужные группы и дайте права администратора.

## Основные команды

- `/start` — Главное меню
- `/help` — Справка
- `/collect` — Собрать участников группы
- `/exclude` — Исключить участника из опроса
- `/newpoll` — Создать новый опрос (через выбор группы)
- `/setmessage <текст>` — Установить текст опроса
- `/setoptions <варианты через запятую>` — Установить варианты ответа
- `/startpoll` — Запустить опрос
- `/results` — Показать результаты опроса
- `/mychats` — Показать список известных групп
- `/cleangroup` — Очистить список участников группы

## Кнопочное меню

- **Создание опроса** — через выбор группы
- **Список участников** — по всем группам сразу
- **Список групп** — выбор группы кнопкой
- **Обновить результаты в группе** — отдельная кнопка в результатах

## Особенности

- Все действия с группами происходят через выбор кнопкой (даже если группа одна)
- При миграции группы в супергруппу бот автоматически обновляет chat_id во всех таблицах
- В результатах опроса и списке не проголосовавших учитываются только уникальные пользователи
- Для админов доступно удобное меню управления
- Все сообщения форматируются для лучшей читаемости (HTML)

## Зависимости

- python-telegram-bot==20.8
- python-dotenv

## Переменные окружения

- `BOT_TOKEN` — токен Telegram-бота (обязателен)

## FAQ

- **Бот не видит группу?**
  — Добавьте бота в группу и дайте права администратора, напишите любое сообщение в группе.
- **Группа мигрировала в супергруппу?**
  — Бот автоматически обновит chat_id и продолжит работу.
- **Не отображаются участники/результаты?**
  — Используйте /collect и убедитесь, что бот админ.

---

**Разработка и поддержка:** t.me/yourusername 